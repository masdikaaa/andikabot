services:
  andika-bot:
    image: andikabot:3.3.0
    container_name: andikabot
    build:
      context: .
      dockerfile: Dockerfile
    restart: always
    hostname: "${HOSTNAME}"

    environment:
      - NODE_ENV=production
      - TZ=Asia/Jakarta
      - HOSTNAME=${HOSTNAME}

      # --- AndikaBot runtime tuning (sudah kamu pakai) ---
      - ANDIKA_DEBUG=0
      - ANDIKA_USE_PRESENCE=1
      - ANDIKA_MAX_INFLIGHT=24
      - ANDIKA_CHAT_QMAX=20
      - ANDIKA_BUCKET_CAP=6
      - ANDIKA_BUCKET_REFILL=3
      - ANDIKA_CHAT_COOLDOWN_MS=1200
      - ANDIKA_USER_COOLDOWN_MS=2500

      # --- QR to logs & stabilitas ---
      - ANDIKA_WATCHDOG=0           # default OFF (hindari spam reconnect)
      - ANDIKA_WATCHDOG_MIN=60      # kalau nanti ON, idle limit menit
      - FORCE_COLOR=1               # warna di logs biar enak dibaca
      - TERM=xterm-256color

    volumes:
      - ./session:/app/session
      - ./config.js:/app/config.js
      - ./settings.js:/app/settings.js
      - ./data:/app/data
      - ./tmp:/app/tmp

    dns:
      - 1.1.1.1
      - 8.8.8.8

    ulimits:
      nofile:
        soft: 65535
        hard: 65535

    security_opt:
      - no-new-privileges:true

    healthcheck:
      test: ["CMD-SHELL", "node -e \"process.exit(0)\""]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 20s
